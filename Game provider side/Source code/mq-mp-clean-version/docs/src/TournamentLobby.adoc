= MaxQuest Tournament Lobby
Betsoft Gaming
v0.1
:source-highlighter: coderay

== 1. Lobby Protocol
This document describes communication between MaxQuest Tournament Lobby and Game Server. +
When tournament Lobby loaded, it should establish websocket connection with Game Server and use this protocol for communication.

=== 1.1 EnterLobby
[source,json]
{
  "sid": "4_eb0bf169cbb477b6f8430000015cbe83_fwRFDR4FWFZTV142PiQUCQ4H",
  "date": 1496750162302,
  "class": "EnterLobby",
  "rid": 1,
  "lang": "en"
}

[source,json]
{
  "class": "EnterLobbyResponse"
  "tournaments": [
    {
      "id": 1001,
      "title": "Captain Brutus's party",
      "startDate": 1496750162302,
      "endDate": 1506750162302,
      "buyInPrice": 100,
      "buyInAmount": 1000,
      "reBuyPrice": 50,
      "reBuyAmount": 500,
      "reBuyAllowed": true,
      "reBuyLimit": 200,
      "prizePool": 250000,
      "joined": true,
      "state": "FINISHED",
      "icon": "https://betsoft.com/tournaments/icon1.png",
      "games": [808]
    },
    {
      "id": 1002,
      "title": "Amazonian Journey",
      "startDate": 1496750162302,
      "endDate": 1506750162302,
      "buyInPrice": 0
      "buyInAmount": 1000,
      "reBuyPrice": 0,
      "reBuyAmount": 500,
      "reBuyAllowed": false,
      "reBuyLimit": -1,
      "prizePool": 2500,
      "joined": false,
      "state": "STARTED",
      "icon": "https://betsoft.com/tournaments/icon1.png",
      "games": [821]
    },
  ],
  "balance": 12345,
  "currencySymbol": "$"
}

tournaments:: list of visible tournaments
tournaments:id:: tournament id
tournaments:title:: tournament title
tournaments:startDate:: tournament start date
tournaments:endDate:: tournament end date
tournaments:buyInPrice:: tournament participation cost, 0 for free-roll tournaments
tournaments:buyInAmount:: initial tournament balance
tournaments:reBuyPrice:: price to purchase additional bullets, 0 for free-roll tournaments
tournaments:reBuyAmount:: amount of money added to tournament balance after reBuy
tournaments:reBuyAllowed:: true if tournament allows re-buys
tournaments:reBuyLimit:: rebuys count limited, -1 for no limit
tournaments:prizePool:: total tournament's prize pool
tournaments:joined:: true if player already joined this tournament
tournaments:state:: current tournament's state, possible values - READY, STARTED, FINISHED, CANCELLED
tournaments:games:: ids of games which could be used to participate in this tournament
balance:: current player's real balance
currencySymbol:: symbol of player's balance currency

=== 1.2 GetTournamentDetails
[source,json]
{
  "class": "GetTournamentDetails",
  "rid": 1,
  "date": 1496750162302,
  "tournamentId": 123
}

[source,json]
{
  "class": "TournamentDetails",
  "rid": 1,
  "date": 1496750162302,
  "tournamentId": 123,
  "title": "Captain Brutus's party",
  "description": "Captain Brutus invites you to join his party and gives a lot of presents",
  "startDate": 1496750162302,
  "endDate": 1506750162302,
  "buyInPrice": 0,
  "buyInAmount": 1000,
  "reBuyPrice": 0,
  "reBuyAmount": 500,
  "reBuyAllowed": false,
  "reBuyLimit": 200,
  "prizePool": 250000,
  "games": [808]
  "state": "STARTED"
  "prizes": [
    { "place": 1, "prize": 100000 },
    { "place": 2, "prize": 50000 },
    { "place": 3, "prize": 25000 },
    { "place": 4, "prize": 25000 },
    { "place": 5, "prize": 25000 },
    { "place": 6, "prize": 5000 },
    { "place": 7, "prize": 5000 },
    { "place": 8, "prize": 5000 },
    { "place": 9, "prize": 5000 },
    { "place": 10, "prize": 5000 }
  ]
}

=== 1.3 TournamentStateChanged
[source,json]
{
  "class": "TournamentStateChanged",
  "date": 1496750162302,
  "rid": -1,
  "tournamentId": 123,
  "state": "CANCELLED"
}

=== 1.4 NewTournament
[source,json]
{
  "class": "NewTournament",
  "date": 1496750162302,
  "rid": -1,
  "tournament": {
    "id": 1002,
    "title": "Amazonian Journey",
    "startDate": 1496750162302,
    "endDate": 1506750162302,
    "buyInPrice": 100,
    "buyInAmount": 1000,
    "reBuyPrice": 50,
    "reBuyAmount": 500,
    "reBuyAllowed": false,
    "reBuyLimit": 200,
    "prizePool": 2500,
    "joined": false,
    "state": "STARTED",
    "icon": "https://betsoft.com/tournaments/icon1.png",
    "games": [821]
  }
}

=== 1.5 JoinTournament
[source,json]
{
  "class": "JoinTournament",
  "tournamentId": 123,
  "gameId": 808,
  "date": 1496750162302,
  "rid": 1
}

[source,json]
{
  "class": "JoinTournamentResponse",
  "tournamentId": 123,
  "gameId": 808,
  "balance": 1000,
  "rid": 1,
  "link": "https://betsoft.com/launch.jsp?..."
}

[source,json]
{
  "class": "Error",
  "date": 1496750162302,
  "rid": -1,
  "code": 1002,
  "message": "Insufficient Funds"
}

=== 1.6 GetLeaderboard
[source,json]
{
  "class": "GetLeaderboard",
  "date": 1496750162302,
  "rid": 1,
  "tournamentId": 123
}

[source,json]
{
  "class": "Leaderboard",
  "date": 1496750162302,
  "rid": 1,
  "tournamentId": 123,
  "endDate": 150000000000,
  "state": "STARTED",
  "prizePlaces": 10,
  "leaderboard": [
    { "place": 1, "name": "Mad Max", "score": 26550, "prize": 100000 },
    { "place": 2, "name": "Punisher 444", "score": 18960 },
    { "place": 3, "name": "Blue1988", "score": 17990 },
    { "place": 4, "name": "Big Daddy", "score": 15002 },
    { "place": 5, "name": "Sebastian F", "score": 14440 },
    { "place": 6, "name": "Eddy Brock 123", "score": 13500 },
    { "place": 7, "name": "Chelsea 505", "score": 12005 },
    { "place": 8, "name": "Marcus M", "score": 10400 },
    { "place": 9, "name": "Blade United", "score": 9660 },
    { "place": 10, "name": "Lost Soul 1979", "score": 8700 },
    { "place": 11, "name": "One_Behind", "score": 7740 },
    { "place": 12, "name": "Brutal Truth 345", "score": 6220 },
    { "place": 13, "name": "Deformero", "score": 5550 },
    { "place": 14, "name": "Jason New_Kid", "score": 4110 }
  ]
}

=== 1.7 BalanceUpdated
Server sends this message periodically to notify client about real balance updates

[source,json]
.Response
{
  "class": "BalanceUpdated",
  "date": 1496748898812,
  "rid": -1,
  "balance": 1236600
}

== 2. Error Codes
Error codes with id's below 1000 are fatal and could not be recovered on client side

|===
| Error code | Error name | Description

| 1
| INTERNAL_ERROR
| Unexpected error, please report it to BSG Server team

| 2
| SERVER_SHUTDOWN
|

| 3
| INVALID_SESSION
| Attempt to launch lobby with wrong session id

| 4
| FOUND_PENDING_OPERATION
| Player has pending operation, play is not possible

| 1001
| BAD_REQUEST
| Request is not recognized by server, check syntax or consult with Server Team

| 1002
| NOT_LOGGED_IN
| Client should perform EnterLobby first

| 1003
| NOT_ENOUGH_MONEY
| Player doesn't have enough money for BuyIn

| 1004
| TOURNAMENT_NOT_FOUND
| Requested tournament is not exist or not visible for this player

| 1005
| NOT_JOINED
| Attempt to get url for not joined tournament
|===





